# 第７章　仮説検定

## 7.1 統計的仮説検定

**統計的仮説検定**：  
パラメータの値が，パラメータ空間のある部分集合に含まれているかどうかを，標本をもとにして判定する方法

ここでいう`パラメータ`とは，統計モデルがパラメトリックなモデル（パラメータを指定すると，モデルが確定するようなモデル．また，各パラメータで与えられるモデルはすべて独立でなければならない）であることを前提とした上でのものである．

### 7.1.1 帰無仮説と対立仮説

**前提**

パラメータ空間 $\Theta$を， $\Theta_0, \Theta_1\subset \Theta$ の２つに分割する．  
統計モデルを$\{f(x:\theta);\theta\in\Theta\subset\mathcal{R}\}$ とし，  
$\mathcal{X} = \{X_1,X_2,\cdots,X_n\}$ をそこからのランダム標本とする．  
ここでの統計モデルは，確率関数または確率密度関数とする．

**定義**

帰無仮説（null hypothesis）：  
$H_0$ ： $\theta\in\Theta_0$  
対立仮説（alternative hypothesis）：  
$H_1$ ： $\theta\in\Theta_1$

$\Theta_0$ or $\Theta_1$の元が１つなら単純仮説（simple hypothesis），２つ以上なら複合仮説（composite hyphotesis）という．

**Q：仮説検定とは**  
付与データをもとに，帰無仮説 $H_0$ を採択するか，棄却する（つまり対立仮説 $H_1$ を採択する）という結論を出すこと．

**Memo**：  
統計モデルが正規分布ならば，パラメータは平均 $\mu$ と分散 $\sigma^2$ である．例えば，平均値が $100$ もしくは $200$ なのがわかっていれば，パラメータ空間は $\Theta=\{100,200\}$ であり，単純帰無仮説として $\Theta_0=100$ をとれば，単純対立仮説として $\Theta_1=200$ となる．

### 7.1.2 検定・検定統計量と，その棄却・採択域

**検定（test）**：  
帰無仮説の採択・棄却を決定するのに用いる，データの値に対する規則．  
例えば，データ ${\bf x}\in \mathcal{R}^n$ が帰無仮説を棄却する時に入る部分集合 $C\subset\mathcal{R}^n$ を決めておけば，それで十分である．

**検定統計量（test statistic）**：  
検定に使われる統計量（上記のデータ ${\bf x}\in \mathcal{R}^n$のようなもの．）

**棄却域（critical region）**：  
データ ${\bf x}\in \mathcal{R}^n$ が帰無仮説を棄却する時に入る部分集合 $C\subset\mathcal{R}^n$．

**採択域（acceptance region）**：  
$C$ の補集合 $C^c$ ．

**検定関数**（critical function）：  
検定統計量が棄却域に入ったか否かをラベル付する関数
$$
\varphi({\bf x}) = \left\{
\begin{array}{ll}
1 & ({\bf x} \in C) \\
0 & ({\bf x} \notin C)
\end{array}
\right.
$$
単に「**検定 $\varphi$ **」とも言う．

*片側検定（one-sided test）*：  
対立仮説が $H_1:\theta >\theta_0$ や $H_1:\theta < \theta_0$ の形をしている検定．

*両側検定（two-sided test）*：  
対立仮説が $H_1:\theta\neq\theta_0$ （単純帰無仮説の場合と同値）の形をしている検定．

### 7.1.3 第１種，第２種の誤り

統計的仮説検定の「誤り方」には二種類ある．

1. 帰無仮説が正しいにもかかわらず，これを棄却する．  
（**第１種（タイプ１）の誤り（error of  the first kind，type I error）**）
2. 帰無仮説が誤っているにもかかわらず，これを採択する．  
（**第２種（タイプ２）の誤り（error of the second kind, type II error）**）

これらの**「検定を誤る確率」を求める事には意義がある**．数式で書き下すと，以下の通り．

Type 1 error の確率：
$$P_\theta[{\bf X}\in C|\theta \in \Theta_0]\qquad(=P_\theta[{\bf X}\in C|H_0]=P_\theta[{\bf X}\in C|\theta \in \Theta-\Theta_1])$$
Type 2 error の確率：
$$P_\theta[{\bf X}\in C^C|\theta \in \Theta_1]\qquad(=P_\theta[{\bf X}\in C^C|H_1]=P_\theta[{\bf X}\in C^C|\theta \in \Theta-\Theta_0])$$

上記のカッコ内２つ目の式から自明な通り，Type1の確率が $0$ の検定は，Type2の確率が $1$ になる．どちらの確率も $0$ になる検定が望ましいが，一般的にそのような検定は存在しない．実際には，例えば，あるType1の確率値を持ったもので，Type2が最も小さい検定を選ぶやり方を採用したりする．

### 7.1.4 検出力関数，検定の大きさ，有意水準

実際に帰無仮説が正しくない時， 帰無仮説が棄却される確率が，その検定の「正しくパラメータを検出する力」と言える．（逆に，帰無仮説が正しくない時，帰無仮説が採択される確率は，Type II error である．）

**検出力関数（power function）：**  
すべてのパラメータ $\theta\in\Theta$ に対して，帰無仮説を棄却する確率．
$$\beta(\theta)=P_\theta[{\bf X}\in C]$$
 $C$ は前で定義したとおり，与えられたデータ ${\bf x}\in{\bf R}^n$ が帰無仮説を棄却する時の部分集合 $C\subset {\bf R}^n$ （棄却域）である．
 
 $\theta_1\in \Theta_1$ のとき（つまり実際に帰無仮説が正しくない時）の $\beta(\theta_1)$（つまり帰無仮説が棄却される確率） を，** $\theta_1$ に対する検出力（power against $\theta_1$）**という． 
 
  検定関数 $\varphi({\bf x})$ を用いると，その検定の検定力は，$ \theta\in\Theta$ として，検定関数の期待値：
 $$E_\theta [\varphi({\bf X})]$$
 と表すことができる．計算すれば，
 $$
  {\bf X}\in C,\quad \theta\in\Theta
  $$
  $$
 \begin{align}
 E_\theta[\varphi({\bf X})] &= \frac{1}{n}\sum_{i=1}^{n} \varphi_\theta({\bf x}_i)\\
 &= P_\theta[{\bf X}\in C] \\
 &= \beta(\theta) \qquad\qquad(Q.E.D)
 \end{align}
 $$ 
 
 逆に， $\theta_0 \in \Theta_0$ のときの $\beta(\theta_0)$ は，帰無仮説が正しい時に，帰無仮説を棄却する確率であり，これはただの Type I error 確率である．これを用いて，次のことを定める．
 
 **検定の大きさ（size of a test）：**  
 帰無仮説のもとでのパラメータの中で，Type I error （帰無仮説が正しいのに棄却する）確率の最大のもの．
 $$\alpha=\sup_{\theta\in\Theta_0}\beta(\theta)$$
 
 **有意水準（level of significance)：**  
 検定を行う際の基準として仮説的に設ける，検定の大きさの最大値．  
 例えば，「有意水準 $\alpha_0$ の検定を行う」という意味は，ある値 $\alpha_0(0<\alpha_0<1)$を仮説的に定め，検定の大きさが $\alpha_0$ より小さい（つまり$\alpha\leq\alpha_0$である ）ような $\alpha$ を用いて検定を行う，ということである．この時，「有意水準 $\alpha_0$ の検定では，帰無仮説が（正しいにもかかわらず）有意水準 $\alpha_0$ で棄却された」という．
 
 有意水準の値は，通常 $0.01,0.05$ などが用いられるが，その選択は任意であり，状況や，特に Type I error の重大さに依存する．
 
 
### 7.1.5 p値，有意確率

**p値（p-value），有意確率（significance probability）**：  
与えられたデータの値に対し，帰無仮説を棄却できる最小の有意水準．（Type I error を起こす最小の検定の大きさ）

例示
> たとえば，ある観測値を得たところ，有意確率が0.08であったということは，有意水準が0.08以上の検定では，この観測値をもとにした場合は，帰無仮説は棄却されるということ．対して，有意水準0.08以下の検定では，帰無仮説は棄却されないということである．

有意確率は，帰無仮説が正しいとした時，実際に得られた値（また，もっと極端な値）を観測する確率．よって，次のようにとらえられる：
$$有意確率=データと帰無仮説との一致率（乖離率）$$
有意確率が小さければ，それだけ帰無仮説に一致しているということになる．

例7.1.5
> $X$を未知の平均 $\mu$ と分散１の正規分布に従っているとする． $H_0$： $\mu\leq 10$ ， $H_1$ ： $\mu >10$ をそれぞれ帰無仮説，対立仮説とする． $X$ の値が $k$ より大きい時，帰無仮説を棄却する．すなわち，棄却域は $C=\{x:x>k\}$ の形になる．ここで， $k$ は有意水準によって決まる定数である．有意水準を0.05とすると，
$$
P[X\in C|\mu\leq 10]=P[X>k|\mu\leq 10]\leq 0.05
$$
より， $k=11.645$ のとき，
$$
P\left[Z>\frac{(11.645-10)}{1}\right]=0.05
$$
である．（ $Z$ は標準正規分布に従う確率変数）． $X$ が11.645より大きいときは，帰無仮説を棄却する検定は有意水準0.05の検定であり，その検出力関数は，
$$
\begin{array}
\beta(\mu) &= P_\mu[X\in C] = P_\mu[X>11.645] = P\left[Z>\frac{(11.645-\mu)}{1}\right] \\
&= 1-\Phi\left[\frac{(11.645-\mu)}{1}\right]
\end{array}
$$
で与えられる，（ $Z$は標準正規分布に従う確率分布，$\Phi(z)$は，標準正規分布の分布関数）．たとえば， $\mu = 10.745$ に対するこの検定の検出力は，
$$
\beta(10.745) = P\left[Z>\frac{(11.645-10.745)}{1}\right] = 1-\Phi(0.9) = 0.1841.
$$
$ \mu = 12.745 $ に対する検出力は，
$$
\beta(12.745) = P\left[Z>\frac{(11.645-12.745)}{1}\right] = 1-\Phi(-1.1) = 0.8643.
$$
$ \mu = 13.645$ に対する検出力は，
$$
\beta(13.645) = P\left[Z>\frac{(11.645-13.645)}{1}\right] = 1-\Phi(-2.0) = 0.9773.
$$
検定の大きさは，
$$
\alpha = \sup_{\mu\leq 10}\beta(\mu) = \sup_{\mu\leq 10}P\left[Z>\frac{(11.645-\mu)}{1}\right] = 1-\Phi(1.645) = 0.05.
$$
実際に観測値が12.1であったとすると，12.1は棄却域に入るので，帰無仮説 $H_0:\mu\leq 10$ は，有意水準0.05で棄却され， $\mu$ は10よりも大きいという結論が導かれる．  
また， $$P[X>12.1|\mu=10] = P]Z>2.1] = 0.0179$$
が有意確率である，この観測値の時，有意水準が0.0179以上の検定では帰無仮説を棄却し，有意水準が0.0179より小さい検定においては，棄却しない．すなわち，帰無仮説が正しいとすると（ $\mu = 10$ の時）， $X=12.1$ よりも大きい値を観測する確率は， $0.0179$ である．この確率を十分小さいと思うときは，このデータは帰無仮説下での分布に従うとするよりは，対立仮説のもとでの分布に従うと考えるほうが自然であり，対立仮説を採択するわけである．

